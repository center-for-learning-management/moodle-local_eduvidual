define(["jquery","core/ajax","core/notification","core/str","core/url","local_eduvidual/main"],function(a,b,c,d,e,f){return{widgets:[],currentQRScanner:void 0,fixDrawingCanvas:function(){a(".drawingcanvas").each(function(){a(this).attr("touch-action","none").attr("style",a(this).attr("style")+";touch-action: none;")})},getwidgetid:function(){for(var a=(+new Date+100*Math.random()).toString(32);"undefined"!=typeof this.widgets[a];)a=(+new Date+100*Math.random()).toString(32);return a},jqPanel:function(b){var c=this.getwidgetid(),d=a(b);this.widgets[c]={panel:d,widgetid:c,run:function(){}}},switchtab:function(b,c,d){for(var e=0;e<a(".tab-container-"+b+">*").length;e++)a("#"+b+"-tab-"+e).css("display",c==e?"block":"none");a(".tab-container-"+b+">*").removeClass("btn-primary"),a(d).addClass("btn-primary")},panel:function(b){if("undefined"!=typeof a(b).attr("data-widgetid"))this.widgets[a(b).attr("data-widgetid")].toggle();else{var c=this.getwidgetid();this.widgets[c]={widgetid:c,runnable:void 0,panel:b,init:function(){console.log(this),a(this.panel).attr("data-widgetid",this.widgetid),this.layer=a("<div>").attr("onclick",'require(["local_eduvidual/widgets"], function(WIDGETS) { WIDGETS.widgets[\''+this.widgetid+"'].run(); });").addClass("eduvidual-widget-panel-layer widget-"+this.widgetid),a("body").append(this.layer);var b=this;a(this.panel+" a").each(function(c){if(!a(this).hasClass("widget-close-on-click")){a(this).addClass("widget-close-on-click");var d='require(["local_eduvidual/widgets"], function(WIDGETS) { WIDGETS.widgets[\''+b.widgetid+"'].toggle(-1); %original% });";d=a(this).is("[onclick]")?d.replace("%original%",a(this)[0].getAttribute("onclick")):d.replace("%original%",""),a(this).attr("onclick",d)}}),this.toggle()},toggle:function(b){"undefined"==typeof b&&(b=0);var c=a(this.panel).hasClass("ui-panel-closed")?1:-1;1!=c&&1!=b||(a(this.panel).removeClass("ui-panel-closed").addClass("ui-panel-open"),a(this.layer).addClass("show")),c!=-1&&b!=-1||(a(this.panel).addClass("ui-panel-closed").removeClass("ui-panel-open"),a(this.layer).removeClass("show"))},run:function(){console.log("Closing panel",this.panel," of ",this),this.toggle(-1)}},this.widgets[c].init()}},prompt:function(){var b=this.getwidgetid();return this.widgets[b]={widgetid:b,runnable:void 0,container:void 0,input:void 0,create:function(b,c,d,e){this.runnable=e,this.container=a("<div>").addClass("local_eduvidual_prompt prompt_"+this.widgetid);var f=a("<div>"),g=a("<div>"),h=a("<div>"),i=a("<div>");"undefined"!=typeof b&&""!=b&&(g=g.addClass("header").html(b)),"undefined"!=typeof c&&""!=c&&(h=h.addClass("main").html(c)),i=i.addClass("controls").attr("data-role","controlgroup"),this.input=a("<input>").attr("type","text").attr("value",d),h.append(this.input);var j=a('<a href="#" data-role="button" onclick="require([\'local_eduvidual/widgets\'], function(WIDGETS) { WIDGETS.widgets[\''+this.widgetid+"'].run(); });\">").html("ok"),k=a('<a href="#" data-role="button" onclick="require([\'local_eduvidual/widgets\'], function(WIDGETS) { WIDGETS.widgets[\''+this.widgetid+"'].destroy(); });\">").html("cancel");i.append([j,k]),f.append([g,h,i]),this.container.append(f),a("body").append(this.container),a(this.input).focus()},run:function(){return this.runnable.run(this.input.val()),this.destroy(),!1},destroy:function(){a(this.container).remove()}},this.widgets[b]},qrscanner:function(){var a=this.getwidgetid();return this.widgets[a]={widgetid:a,runnable:void 0,scan:function(a,b){"undefined"==typeof b&&(b=!1),this.endless=b,this.runnable=a;var e=this;d.get_strings([{key:"qrscan:cameratoobject",component:"local_eduvidual"}]).done(function(a){cordova.plugins.barcodeScanner.scan(function(a){"undefined"!=typeof a.text&&""!=a.text&&e.runnable.run(a.text),e.endless&&"undefined"!=typeof a.text&&""!==a.text&&e.scan(e.runnable,!0)},function(a){c.alert("Scanning Error: "+a)},{preferFrontCamera:!1,showFlipCameraButton:!0,showTorchButton:!0,torchOn:!0,prompt:a[0],resultDisplayDuration:500,formats:"QR_CODE,PDF_417",disableAnimations:!0,disableSuccessBeep:!1})}).fail(c.exception)}},this.widgets[a]}}});