define(["jquery","core/ajax","core/notification","core/str","core/url","local_eduvidual/main"],function(n,t,l,e,o,a){return{debug:false,dashboardEnhanceInfo:{},run:function(a){console.log("local_eduvidual/jsinjector:run(data)",a);e.get_strings([{key:"Accesscard",component:"local_eduvidual"}]).then(function(a){n('.usermenu .dropdown a[href$="/user/preferences.php"]').after(n("<a>").attr("href",o.relativeUrl("local/eduvidual/pages/accesscard.php")).addClass("dropdown-item menu-action").attr("role","menuitem").attr("data-title","moodle,accesscard").attr("aria-labelledby","actionmenuaction-accesscard").attr("data-ajax","false").append([n("<i>").addClass("icon fa fa-id-card fa-fw").attr("aria-hidden","true"),n("<span>").addClass("menu-action-text").attr("id","actionmenuaction-accesscard").html(a[0])]))});n("a[href*='/login/logout.php?sesskey']").attr("href",o.relativeUrl("/local/eduvidual/pages/redirects/logout.php"));this.fakeBreadCrumb()},clearSessionStorage:function(){console.log("local_eduvidual/jsinjector:clearSessionStorage()");window.sessionStorage.clear()},dashboardCourseLoaded:function(){console.log("local_eduvidual/jsinjector:dashboardCourseLoaded()");var a=this;n(".dashboard-card-deck>.dashboard-card:not(.local-eduvidual-enhanced)").each(function(){a.dashboardEnhanceCourse(n(this))})},dashboardEnhanceCourse:function(e){e.addClass("local-eduvidual-enhanced local-eduvidual-transition-all");var o=this;var r=+n(e).attr("data-course-id");var a=n(e).find(".dashboard-card-footer");if(r>0){if(typeof this.dashboardEnhanceInfo[r]!=="undefined"){var d=this.dashboardEnhanceInfo[r];e.attr("id","dashboard-card-"+r);a.empty().append(n("<a>").html(d.label).attr("href","#").attr("onclick","$('#dashboard-card-"+r+">*').toggleClass('local-eduvidual-height-no'); return false;"));e.append(n("<div>").addClass("local-eduvidual-height-no").append([n("<a>").html("hide").attr("href","#").attr("onclick","$('#dashboard-card-"+r+">*').toggleClass('local-eduvidual-height-no'); return false;")]))}else{a.empty();t.call([{methodname:"local_eduvidual_user_course_news",args:{courseid:r},done:function(a){console.log("got reply for courseid "+r,a);if(typeof a.label!=="undefined"&&a.label!=""){o.dashboardEnhanceInfo[r]=a;o.dashboardEnhanceCourse(e)}},fail:l.exception}])}}else{console.error("Courseid is empty",r)}},fakeBreadCrumb:function(){if(n("#page #page-header .card-body .d-flex.flex-wrap #page-navbar").length==0){e.get_strings([{key:"navigation",component:"core"},{key:"myhome",component:"core"}]).then(function(a){n("#page #page-header .card-body .d-flex.flex-wrap").prepend(n('<div id="page-navbar">').append(n('<nav role="navigation" aria-label="'+a[0]+'">').append(n('<ol class="breadcrumb">').append(n('<li class="breadcrumb-item">').append(n('<a data-ajax="false">').attr("href",o.relativeUrl("/my")).html(a[1]))))))})}},modifyRedirectUrl:function(a){if(this.debug)console.log("local_eduvidual/jsinjector:modifyRedirectUrl(type)",a);if(a=="coursedelete"){n("#page-content .continuebutton form").attr("action",o.relativeUrl("/my"));n('#page-content .continuebutton form input[name="categoryid"]').remove()}},orgMenu:function(a){if(this.debug)console.log("local_eduvidual/jsinjector:orgMenu(orgmenu)");n(a).insertBefore(n("#page-wrapper>.navbar div.usermenu").closest("li"))}}});